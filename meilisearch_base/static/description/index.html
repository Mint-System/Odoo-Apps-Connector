<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
</head>
<body><a href="http://www.gnu.org/licenses/gpl-3.0-standalone.html">
        <img alt="License: GPL-3" src="https://img.shields.io/badge/licence-GPL--3-blue.svg" />
    </a>
    <section id="meilisearch-base">
        <h1>Meilisearch Base</h1>
        <p>Sets up meilisearch indexes and provides a document mixin.</p>
        <p>For a detailed documentation have a look at <a href="https://www.odoo-wiki.org/meilisearch-base.html">https://www.odoo-wiki.org/meilisearch-base.html</a></p>
        <section id="configuration">
            <h2>Configuration</h2>
            <ul>
                <li>Inherit the Meilisearch document mixin for the model:</li>
            </ul>
            <pre data-language="python"><span class="k">class</span> <span class="nc">Country</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s2">&quot;res.country&quot;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;res.country&quot;</span><span class="p">,</span> <span class="s2">&quot;meilisearch.document.mixin&quot;</span><span class="p">]</span></pre>
            <ul>
                <li>Modify the document schema:</li>
            </ul>
            <pre data-language="python"><span class="k">def</span> <span class="nf">_prepare_index_document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">document</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_prepare_index_document</span><span class="p">()</span>
    <span class="n">document</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span>
    <span class="n">document</span><span class="p">[</span><span class="s1">&#39;currency_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency_id</span><span class="o">.</span><span class="n">name</span>
    <span class="k">return</span> <span class="n">document</span>

<span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;currency_id.name&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_compute_index_document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_compute_index_document</span><span class="p">()</span></pre>
            <ul>
                <li>Modify the document filter:</li>
            </ul>
            <pre data-language="python"><span class="k">def</span> <span class="nf">_get_index_document_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">code</span> <span class="o">!=</span> <span class="s2">&quot;CH&quot;</span></pre>
            <ul>
                <li>Hook into meilisearch tasks:</li>
            </ul>
            <pre data-language="python"><span class="k">class</span> <span class="nc">MeilisearchTask</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;meilisearch.task&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">task_succeeded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Succeeded documents: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_document_ids</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">task_succeeded</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">task_failed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed documents: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_document_ids</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">task_failed</span><span class="p">()</span></pre>
            <section id="usage">
                <h3>Usage</h3>
                <ul>
                    <li>Open "Settings &gt; Integration" and set Meiliesarch API url and key</li>
                    <li>Add user to the "Meilisearch Index Manager" group</li>
                    <li>Create entries in "Settings &gt; Technical &gt; Meilisearch Indexes"</li>
                    <li>Use Odoo url <cite>/meilisearch/task-webhook</cite> path for the Meilisearch task webhook</li>
                </ul>
            </section>
        </section>
        <section id="maintainer">
            <h2>Maintainer</h2>
        <a href="https://www.mint-system.ch">
                <img src="https://raw.githubusercontent.com/Mint-System/Wiki/master/assets/mint-system-logo.png" alt="" />
            </a>
            <p>This module is maintained by Mint System GmbH.</p>
            <p>For support and more information, please visit <a href="https://www.mint-system.ch">our Website</a>.</p>
        </section>
    </section>
</body>
</html>